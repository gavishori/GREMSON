<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GREMSON - מחשבון עסקה</title>
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif; /* Using Inter font as per instructions */
            margin: 20px;
            text-align: right; /* Align text to the right for RTL */
            background-color: #f4f7f6; /* Light background for better aesthetics */
            color: #191970; /* Dark blue for all text */
        }
        .header-container {
            display: flex;
            justify-content: center; /* Center the header content */
            align-items: center; /* Vertically align items */
            margin-bottom: 5px; /* Reduced margin to bring clocks closer */
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db; /* Blue underline */
        }
        .header-title-logo {
            display: flex;
            align-items: center;
            flex-grow: 1; /* Allow title and logo to take available space */
            justify-content: center; /* Center the title */
        }
        h1 {
            color: #191970; /* Dark blue for heading */
            text-align: center;
            margin: 0; /* Remove default margin */
            flex-grow: 1; /* Allow heading to take available space */
        }
        .logo {
            display: none; /* Hide the logo as requested */
        }
        .clocks-row-container { /* New container for clocks to be on one line */
            display: flex;
            justify-content: center; /* Center the clocks */
            width: 100%; /* Take full width below the header */
            margin-bottom: 20px; /* Space below clocks */
            padding-right: 0; /* No padding needed for centering */
            box-sizing: border-box; /* Include padding in width */
            gap: 20px; /* Space between clocks (approx 10 spaces) */
        }
        .online-clock {
            color: #191970; /* Dark blue for clock */
            font-size: 0.9em; /* Smaller font size */
            font-weight: normal; /* Not bold */
            white-space: nowrap; /* Prevent wrapping */
            display: flex; /* Use flex to align label and time */
            flex-direction: row; /* Keep label and time on one line */
            align-items: baseline; /* Align text baselines */
        }
        .clock-label {
            direction: rtl; /* Ensure label is RTL */
            text-align: right; /* Align label text to the right */
            flex-shrink: 0; /* Prevent label from shrinking */
            margin-left: 5px; /* Space after the label (e.g., "שעון ישראל:") */
        }
        .clock-time {
            direction: ltr; /* Ensure time is LTR */
            text-align: left; /* Align time text to the left */
            flex-grow: 1; /* Allow time to take remaining space */
            margin-left: 5px; /* Single space after colon */
        }
        .subheading-box { /* Style for the subheading box */
            background-color: #ecf0f1; /* Light grey background for the box */
            border: 1px solid #bdc3c7; /* Grey border */
            padding: 10px 15px;
            border-radius: 8px; /* Rounded corners */
            font-size: 1.1em;
            font-weight: bold;
            color: #191970; /* Dark blue for subheading box text */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); /* Subtle shadow */
            /* Changed from inline-block and float to block for proper stacking */
            display: block;
            width: fit-content; /* Shrink to fit content */
            margin-right: auto; /* Push to right for RTL */
            margin-left: 0; /* No left margin */
            margin-top: 20px;
            margin-bottom: 15px;
            clear: both; /* Clear floats above it */
        }
        .subheading-box h2 { /* Style for the h2 inside the box */
            color: #191970; /* Dark blue for subheading */
            margin: 0; /* Remove default margin from h2 inside the box */
            text-align: right; /* Align text to the right within the box */
            font-size: 1.1em; /* Ensure consistent font size */
            font-weight: bold; /* Ensure consistent font weight */
        }
        /* New styles for table containers */
        .table-wrapper {
            background-color: #ffffff; /* Default white background for wrappers */
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .table-wrapper.main-table {
            background-color: #e6f7ff; /* Light blue */
        }
        .table-wrapper.investment-table-wrapper {
            background-color: #e0f2f7; /* Light cyan/blue */
            flex: 1; /* Allow to grow in flex container */
        }
        .table-wrapper.loan-table-wrapper {
            background-color: #e6f0ff; /* Light lavender blue */
            flex: 1; /* Allow to grow in flex container */
        }
        /* Style for the new Comps content box */
        .comps-content-box {
            background-color: #dbeaf5; /* A slightly different shade of light blue for comps */
            border: 1px solid #bdc3c7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .comps-input-container, .comps-results-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .comps-input-container label, .comps-results-container span {
            font-weight: bold;
            color: #191970;
            white-space: nowrap;
        }
        .comps-input-container input[type="text"] {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            flex-grow: 1;
            box-sizing: border-box;
            background-color: #e0ffe0; /* Light green background */
            text-align: right; /* Align input text to right for RTL */
            color: #191970;
        }
        .comp-result-item {
            display: flex;
            align-items: center;
            justify-content: flex-end; /* Align results to the right */
            flex-grow: 1;
            gap: 5px;
        }
        .comp-result-item span:last-child { /* The actual value */
            font-weight: normal;
            color: #00008B; /* Darker blue for values */
            white-space: nowrap;
        }
        .comps-button-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .comps-button {
            padding: 10px 20px;
            background-color: #3498db; /* Blue button */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }
        .comps-button:hover {
            background-color: #2980b9; /* Darker blue on hover */
        }


        table {
            width: 100%;
            border-collapse: collapse; /* Ensures borders are collapsed for a clean grid */
            /* Removed direct box-shadow and border-radius from table, moved to wrapper */
            margin-top: 0; /* Remove top margin as wrapper handles spacing */
        }
        th, td {
            border: 1px solid #cccccc; /* Changed to a slightly darker border for clearer grid lines */
            padding: 12px 15px;
            text-align: right; /* Align text to the right for RTL */
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #eaf2f8;
        }
        .dollar-rate-container {
            display: flex; /* Use flexbox for horizontal layout */
            justify-content: flex-end; /* Align items to the right for RTL */
            margin-top: 30px;
            margin-bottom: 15px; /* Add some margin below for the new box */
            clear: both; /* Ensure it clears previous floats */
            align-items: center; /* Vertically align items in the container */
            gap: 10px; /* Space between dollar rate box and reset button */
        }
        .dollar-rate-box {
            background-color: #ecf0f1; /* Light grey background for boxes */
            border: 1px solid #bdc3c7; /* Grey border */
            padding: 15px 20px;
            border-radius: 8px; /* Rounded corners */
            font-size: 1.1em;
            font-weight: bold;
            color: #191970; /* Dark blue for dollar rate box text */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); /* Subtle shadow */
            display: flex; /* Use flexbox for content inside the box */
            align-items: center; /* Vertically align-items */
            gap: 10px; /* Space between label and input */
        }
        .dollar-rate-box input[type="number"] {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            width: 100px; /* Adjust width as needed */
            text-align: left; /* Align input text to left */
            color: #191970; /* Dark blue for input text */
        }
        /* Style for the container holding the input and currency/percentage symbol */
        .input-with-symbol-container { /* More generic name */
            display: flex;
            align-items: center;
            justify-content: flex-end; /* Align to the right for RTL */
            width: 100%; /* Ensure the container fills the cell by default */
        }
        /* Style for editable price input fields */
        .editable-price-input {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            flex-grow: 1;
            box-sizing: border-box;
            background-color: #e0ffe0; /* Light green background */
            text-align: right; /* Align input text to right for RTL */
            color: #191970; /* Dark blue for input text */
        }
        /* Style for the currency/percentage symbol span */
        .symbol-left { /* Position symbol to the left of the input (for RTL) */
            margin-right: 5px;
            color: #00008B; /* Slightly lighter dark blue for symbols */
            flex-shrink: 0;
        }
        /* Style for the light red background on profit cells */
        .profit-in-dollars-cell {
            background-color: #ffe0e0; /* Light red background */
        }
        /* Style for light red background on equity cells */
        .equity-cell {
            background-color: #ffe0e0; /* Light red background */
        }
        /* Style for editable percentage input fields */
        .editable-percentage-input {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            width: 100%;
            box-sizing: border-box;
            background-color: #e0ffe0; /* Light green background directly on the input */
            text-align: right; /* Align input text to right for RTL */
            color: #191970; /* Dark blue for input text */
        }
        /* Style for display-only currency cells */
        .display-currency-cell {
            display: flex;
            flex-direction: column; /* Stack dollar and ILS vertically */
            align-items: flex-end; /* Align items to the right within the column */
            width: 100%;
            height: 100%;
            color: #191970; /* Dark blue for display currency cells */
        }
        /* Style for ILS values */
        .ils-container { /* New container for ILS value and symbol */
            display: flex;
            align-items: baseline; /* Align symbol and number */
            margin-top: 2px; /* Small space below dollar value */
            color: #191970; /* Dark blue as requested */
            font-size: 0.8em; /* Smaller font size */
        }
        .ils-value {
            /* Inherits color and font-size from .ils-container */
        }
        .ils-symbol {
            margin-left: 2px; /* Space after the number */
            margin-right: 0; /* Override previous margin-right */
        }

        .additional-right-box { /* Style for the new box */
            background-color: #ecf0f1; /* Light grey background for the box */
            border: 1px solid #bdc3c7; /* Grey border */
            padding: 10px 15px;
            border-radius: 8px; /* Rounded corners */
            font-size: 1.1em;
            font-weight: bold;
            color: #191970; /* Dark blue for additional box text */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); /* Subtle shadow */
            display: block; /* Changed to block */
            width: fit-content; /* Shrink to fit content */
            margin-right: auto; /* Push to right for RTL */
            margin-left: 0; /* No left margin */
            margin-top: 15px; /* Space from the dollar rate box */
            margin-bottom: 15px; /* Space below for the next box */
            clear: both; /* Clear any preceding floats */
        }
        .additional-right-box h3 { /* Style for content inside the new box */
            color: #191970; /* Dark blue for h3 inside box */
            margin: 0;
            text-align: right;
            font-size: 1.1em; /* Ensure consistent font size */
            font-weight: bold; /* Ensure consistent font weight */
        }
        /* Container for the two side-by-side tables */
        .tables-row-container {
            display: flex;
            flex-wrap: wrap; /* Allow tables to wrap on smaller screens */
            justify-content: flex-end; /* Align to the right for RTL */
            gap: 20px; /* Space between tables */
            margin-top: 20px;
            clear: both; /* Clear any preceding floats */
        }
        /* Investment table styling */
        .investment-table {
            width: 100%; /* Ensure table fills its wrapper */
            border-collapse: collapse;
            /* Removed box-shadow, border-radius, overflow from here as it's on the wrapper */
        }
        .investment-table th, .investment-table td {
            white-space: nowrap; /* Prevent text wrapping in cells */
            border: 1px solid #cccccc;
            padding: 12px 15px;
            text-align: right;
            color: #191970; /* Dark blue for table cell text */
        }
        .investment-table th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        .investment-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #eaf2f8;
        }
        /* Style for the investment amount input fields (similar to editable-price-input) */
        .investment-amount-input {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            flex-grow: 1;
            box-sizing: border-box;
            background-color: #e0ffe0; /* Light green background */
            text-align: right;
            color: #191970; /* Dark blue for input text */
        }
        /* Specific styling for the input-with-symbol-container within the "סה&quot;כ $" column of investment table */
        .investment-table td[data-label="סה&quot;כ $"] .input-with-symbol-container {
            width: auto; /* Allow container to shrink to content */
            display: inline-flex; /* Make it inline-flex to shrink-wrap its content */
            /* The parent td's text-align: right will align this inline-flex container to the right */
        }
        /* Loan details table styling */
        .loan-details-table {
            width: 100%; /* Ensure table fills its wrapper */
            border-collapse: collapse;
            /* Removed box-shadow, border-radius, overflow from here as it's on the wrapper */
        }
        .loan-details-table th, .loan-details-table td {
            border: 1px solid #cccccc;
            padding: 12px 15px;
            text-align: right;
            white-space: nowrap;
            color: #191970; /* Dark blue for table cell text */
        }
        .loan-details-table th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        .loan-details-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #eaf2f8;
        }
        /* Specific styling for the loan amount input */
        .loan-amount-input {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            flex-grow: 1;
            box-sizing: border-box;
            background-color: #e0ffe0; /* Light green background */
            text-align: right;
            color: #191970; /* Dark blue for input text */
        }
        /* Specific styling for the interest rate input */
        .loan-interest-input {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            flex-grow: 1;
            box-sizing: border-box;
            background-color: #e0ffe0; /* Light green background */
            text-align: right;
            color: #191970; /* Dark blue for input text */
        }
        /* Specific styling for the input-with-symbol-container within the "סכום ההלוואה בפועל" column of loan table */
        .loan-details-table td[data-label="סכום ההלוואה בפועל"] .input-with-symbol-container {
            width: auto; /* Allow container to shrink to content */
            display: inline-flex; /* Make it inline-flex to shrink-wrap its content */
            /* The parent td's text-align: right will align this inline-flex container to the right */
        }
        /* Specific styling for the input-with-symbol-container within the "אחוז ריבית" column of loan table */
        .loan-details-table td[data-label="אחוז ריבית"] .input-with-symbol-container {
            width: auto; /* Allow container to shrink to content */
            display: inline-flex; /* Make it inline-flex to shrink-wrap its content */
            /* The parent td's text-align: right will align this inline-flex container to the right */
        }
        /* Hide spin buttons for number inputs */
        /* Removed .no-spinners class from here to re-enable spinners */
        /* New summary boxes styling */
        .summary-info-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start; /* Align to the left for RTL */
            gap: 20px;
            margin-top: 20px;
            clear: both;
        }
        .summary-value-box {
            background-color: #ecf0f1; /* Default light grey */
            border: 1px solid #bdc3c7;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            color: #191970; /* Dark blue for summary box text */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            justify-content: flex-end; /* Align content to the right within the box */
            flex: 1; /* Allow boxes to grow and shrink */
            min-width: 120px; /* Minimum width for each box */
        }
        .summary-value-box span {
            white-space: nowrap; /* Prevent text/number wrapping */
        }
        .reset-button {
            padding: 10px 20px;
            background-color: #f44336; /* Red color for reset button */
            color: white; /* Keep white for button text */
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }
        .reset-button:hover {
            background-color: #d32f2f; /* Darker red on hover */
        }
        /* Footer links styling */
        .footer-links-container {
            display: flex;
            justify-content: center; /* Center the links */
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 30px; /* Space between links */
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
        }
        .footer-link-box {
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            text-align: center;
            font-size: 0.9em; /* Smaller font size for footer links */
            font-weight: bold;
            color: #191970;
            text-decoration: none; /* Remove underline from links */
            transition: background-color 0.3s ease;
        }
        .footer-link-box:hover {
            background-color: #dbe4e6;
        }
        .footer-link-box a {
            color: #191970; /* Ensure link text is dark blue */
            text-decoration: none; /* Remove underline */
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .header-container {
                flex-direction: column; /* Stack header items on small screens */
                align-items: center; /* Center items when stacked */
            }
            .header-title-logo {
                flex-direction: column;
                justify-content: center;
            }
            .logo {
                margin-left: 0;
                margin-bottom: 10px; /* Space between logo and title */
            }
            .clocks-row-container {
                flex-direction: column; /* Stack clocks vertically on small screens */
                align-items: center; /* Center clocks when stacked */
                margin-left: 0;
                padding-right: 0;
                gap: 10px;
            }
            .online-clock {
                width: 100%; /* Take full width */
                justify-content: center; /* Center content within clock */
            }
            .dollar-rate-container {
                flex-direction: column; /* Stack columns on small screens */
                align-items: center; /* Center items when stacked */
                gap: 10px;
            }
            .dollar-rate-box {
                width: 90%; /* Make boxes wider on small screens */
                text-align: center;
                flex-direction: column; /* Stack label and input vertically on small screens */
            }
            .dollar-rate-box input[type="number"] {
                width: 80%; /* Adjust input width for small screens */
            }
            .table-wrapper {
                padding: 10px; /* Adjust padding for small screens */
            }
            table {
                display: block; /* Ensure table maintains block display */
            }
            thead {
                display: none; /* Hide table header on small screens */
            }
            tr {
                margin-bottom: 15px;
                display: block;
                border: 1px solid #cccccc;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }
            td {
                border: 1px solid #cccccc;
                padding: 10px 15px; /* פאדינג אחיד או מותאם אישית */
                text-align: right; /* יישור לימין עבור RTL */
                display: flex; /* הפוך את התא לקונטיינר גמיש (flex container) */
                flex-direction: column; /* ערום את התוכן בעמודה */
                align-items: flex-start; /* יישר את התוכן לשמאל בתוך התא */
                position: relative; /* החזר position: relative; כדי למקם את ה-cell-label אם צריך */
                overflow: hidden; /* למנוע גלישה של תוכן ארוך מחוץ לתא */
            }
            td::before {
                content: attr(data-label);
                font-weight: bold;
                text-align: right;
                color: #191970; /* Dark blue for labels on small screens */
                margin-bottom: 5px; /* רווח קטן מתחת לתווית */
                display: block; /* ודא שהתווית תופסת שורה משלה */
                width: 100%; /* תן לה 100% רוחב כדי שלא תתנגש עם תוכן אחר */
            }
            .input-with-symbol-container, .display-currency-cell {
                width: 100%; /* ודא שזה ממלא את הרוחב הזמין */
                justify-content: flex-end; /* יישר את התוכן (מספר + סמל) לימין */
            }
            .editable-price-input, .editable-percentage-input,
            .investment-amount-input, .loan-amount-input, .loan-interest-input {
                width: 100%; /* ודא שהאינפוטים תופסים את כל הרוחב הזמין בתוך הקונטיינר שלהם */
                box-sizing: border-box; /* חשוב כדי שהפאדינג לא יגרום לגלישה */
                text-align: right; /* ודא שגם בתוך האינפוט הטקסט מיושר לימין */
            }
            /* Apply light red background to specific cells on small screens */
            td[data-label="סכום הרווח"],
            td[data-label="השקעה"],
            tr:nth-child(2) td[data-label="מחיר מכירה"],
            tr:nth-child(1) td[data-label="אחוז הרווח"] {
                background-color: #ffe0e0;
            }
            /* Removed specific green background for td in responsive, as input handles it */
            .subheading-box, .additional-right-box, .tables-row-container, .summary-info-row { /* Adjust boxes and table container for small screens */
                width: 90%;
                float: none; /* Remove float */
                text-align: center;
                margin-left: auto;
                margin-right: auto;
                flex-direction: column; /* Stack items vertically */
                gap: 15px; /* Space between stacked items */
            }
            .subheading-box h2, .additional-right-box h3 {
                text-align: center;
            }
            .investment-table, .loan-details-table, .summary-value-box { /* Ensure tables/boxes take full width when stacked */
                width: 100%;
                min-width: unset; /* Remove min-width for stacking */
            }
            .investment-table thead, .loan-details-table thead {
                display: none; /* Hide table header on small screens */
            }
            .investment-table tr, .loan-details-table tr {
                margin-bottom: 15px;
                display: block;
                border: 1px solid #cccccc;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }
            .investment-table td, .loan-details-table td {
                border: 1px solid #cccccc;
                padding: 10px 15px; /* פאדינג אחיד או מותאם אישית */
                text-align: right;
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                position: relative;
                overflow: hidden;
            }
            .investment-table td::before, .loan-details-table td::before {
                content: attr(data-label);
                font-weight: bold;
                text-align: right;
                color: #191970; /* Dark blue for labels on small screens */
                margin-bottom: 5px;
                display: block;
                width: 100%;
            }
            .footer-links-container {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header-container">
        <div class="header-title-logo">
            <img src="uploaded:תמונה1.jpg-0602d63f-d686-4323-b2b7-a5ff02ea1ba0" alt="GREMSON Logo" class="logo">
            <h1>GREMSON - מחשבון עסקה</h1>
        </div>
    </div>
    <div class="clocks-row-container">
        <div class="online-clock">
            <span class="clock-label">שעון ישראל:</span>
            <span id="israelTimeDisplay" class="clock-time"></span>
        </div>
        <div class="online-clock">
            <span class="clock-label">שעון מזרח ארה"ב:</span>
            <span id="easternTimeDisplay" class="clock-time"></span>
        </div>
    </div>
    <div class="subheading-box">
        <h2>חישוב כדאיות</h2>
    </div>
    <div class="table-wrapper main-table">
        <table>
            <thead>
                <tr>
                    <th>השקעה</th>
                    <th>מחיר מכירה</th>
                    <th>סכום הרווח</th>
                    <th>אחוז הרווח</th>
                    <th>תיאור</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td data-label="השקעה" class="equity-cell">
                        <span id="a1Value">100,000</span>
                    </td>
                    <td data-label="מחיר מכירה">
                        <div class="input-with-symbol-container">
                            <input type="number" class="editable-price-input" id="b1Input" value="120000" step="5000">
                            <span class="symbol-left">$</span>
                        </div>
                    </td>
                    <td data-label="סכום הרווח" class="profit-in-dollars-cell">
                        <div class="display-currency-cell">
                            <div>
                                <span id="c1Value">20,000</span>
                                <span class="symbol-left">$</span>
                            </div>
                            <div class="ils-container">
                                <span id="c1ValueILS" class="ils-value"></span><span class="ils-symbol">ש"ח</span>
                            </div>
                        </div>
                    </td>
                    <td data-label="אחוז הרווח" class="profit-in-dollars-cell">
                        <div class="input-with-symbol-container">
                            <span id="d1Value">20</span>
                            <span class="symbol-left">%</span>
                        </div>
                    </td>
                    <td data-label="תיאור">אחוז הרווח לפי מחיר מכירה / השקעה</td>
                </tr>
                <tr>
                    <td data-label="השקעה" class="equity-cell">
                        <span id="a2Value">50,000</span>
                    </td>
                    <td data-label="מחיר מכירה" class="profit-in-dollars-cell">
                        <span id="b2Value">65,000</span>
                    </td>
                    <td data-label="סכום הרווח" class="profit-in-dollars-cell">
                        <div class="display-currency-cell">
                            <div>
                                <span id="c2Value">15,000</span>
                                <span class="symbol-left">$</span>
                            </div>
                            <div class="ils-container">
                                <span id="c2ValueILS" class="ils-value"></span><span class="ils-symbol">ש"ח</span>
                            </div>
                        </div>
                    </td>
                    <td data-label="אחוז הרווח">
                        <div class="input-with-symbol-container">
                            <input type="number" class="editable-percentage-input" id="d2Input" value="30" step="1">
                            <span class="symbol-left">%</span>
                        </div>
                    </td>
                    <td data-label="תיאור">כמה צריך להיות מחיר המכירה לפי אחוז הרווח הנדרש בהתאם להשקעה</td>
                </tr>
                <tr>
                    <td data-label="השקעה" class="equity-cell">
                        <span id="a3Value"></span>
                    </td>
                    <td data-label="מחיר מכירה">
                        <div class="input-with-symbol-container">
                            <input type="number" class="editable-price-input" id="b3Input" step="5000">
                            <span class="symbol-left">$</span>
                        </div>
                    </td>
                    <td data-label="סכום הרווח" class="profit-in-dollars-cell">
                        <div class="display-currency-cell">
                            <div>
                                <span id="c3Value"></span>
                                <span class="symbol-left">$</span>
                            </div>
                            <div class="ils-container">
                                <span id="c3ValueILS" class="ils-value"></span><span class="ils-symbol">ש"ח</span>
                            </div>
                        </div>
                    </td>
                    <td data-label="אחוז הרווח">
                        <div class="input-with-symbol-container">
                            <input type="number" class="editable-percentage-input" id="d3Input" step="1">
                            <span class="symbol-left">%</span>
                        </div>
                    </td>
                    <td data-label="תיאור">כמה צריכה להיות ההשקעה לפי אחוז הרווח הנדרש בהתאם למכירה</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="dollar-rate-container">
        <div class="dollar-rate-box">
            <span>שער הדולר:</span>
            <input type="number" id="dollarRateInput" placeholder="הזן ערך" step="0.01">
        </div>
        <button id="resetButton" class="reset-button">איפוס</button>
    </div>
    <div class="additional-right-box">
        <h3>מימון</h3>
    </div>
    <div class="tables-row-container">
        <div class="table-wrapper investment-table-wrapper">
            <table class="investment-table">
                <thead>
                    <tr>
                        <th>השקעה כספית</th>
                        <th>סה"כ $</th>
                        <th>אחוז ההשקעה</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-label="השקעה כספית">הון עצמי</td>
                        <td data-label="סה&quot;כ $">
                            <div class="input-with-symbol-container investment-total-dollars-input">
                                <input type="number" class="investment-amount-input" id="equityInvestmentInput" step="5000">
                                <span class="symbol-left">$</span>
                            </div>
                        </td>
                        <td data-label="אחוז ההשקעה" class="profit-in-dollars-cell">
                            <div class="display-currency-cell">
                                <span></span>
                                <span class="symbol-left">%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td data-label="השקעה כספית">הלוואה</td>
                        <td data-label="סה&quot;כ $" class="profit-in-dollars-cell">
                            <div class="display-currency-cell">
                                <div>
                                    <span id="loanInvestmentDisplay"></span> <span class="symbol-left">$</span>
                                </div>
                                <div class="ils-container">
                                    <span id="loanInvestmentDisplayILS" class="ils-value"></span><span class="ils-symbol">ש"ח</span>
                                </div>
                            </div>
                        </td>
                        <td data-label="אחוז ההשקעה" class="profit-in-dollars-cell">
                            <div class="display-currency-cell">
                                <span></span>
                                <span class="symbol-left">%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td data-label="השקעה כספית">refinance</td>
                        <td data-label="סה&quot;כ $" class="profit-in-dollars-cell">
                            <div class="display-currency-cell">
                                <div>
                                    <span id="refinanceDollarValue"></span> <span class="symbol-left">$</span>
                                </div>
                                <div class="ils-container">
                                    <span id="refinanceDollarValueILS" class="ils-value"></span><span class="ils-symbol">ש"ח</span>
                                </div>
                            </div>
                        </td>
                        <td data-label="אחוז ההשקעה">
                            <div class="input-with-symbol-container">
                                <input type="number" class="editable-percentage-input" id="refinancePercentageInput" step="1">
                                <span class="symbol-left">%</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="table-wrapper loan-table-wrapper">
            <table class="loan-details-table">
                <thead>
                    <tr>
                        <th>פרטי הלוואה</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-label="סכום ההלוואה">סכום ההלוואה</td>
                        <td data-label="סכום ההלוואה בפועל">
                            <div class="input-with-symbol-container loan-amount-input-container">
                                <input type="number" class="loan-amount-input" id="loanAmountActualInput" value="10000" step="5000">
                                <span class="symbol-left">$</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td data-label="ריבית">ריבית ישרה ולא ריבית דריבית</td>
                        <td data-label="אחוז ריבית">
                            <div class="input-with-symbol-container loan-interest-input-container">
                                <input type="number" class="loan-interest-input" id="loanInterestRateInput" value="10" step="1">
                                <span class="symbol-left">%</span>
                            </div>
                        </td>
                    </tr>
                    <tr class="profit-in-dollars-cell">
                        <td data-label="אחוז הרווח על ההשקעה">אחוז הרווח על ההשקעה</td>
                        <td data-label="אחוז הרווח על ההשקעה">
                            <div class="display-currency-cell">
                                <span id="h3ValueLoanDisplay"></span>
                                <span class="symbol-left">%</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="subheading-box"> <!-- Moved subheading box for Comps here -->
        <h2>Comps</h2>
    </div>
    <div class="comps-content-box">
        <div class="comps-input-container">
            <label for="addressInput">כתובת:</label>
            <input type="text" id="addressInput" placeholder="הזן כתובת">
        </div>
        <div class="comps-results-container">
            <div class="comp-result-item">
                <span>מחיר מכירה משוער:</span>
                <span id="estimatedSalePrice">טוען...</span>
            </div>
            <div class="comp-result-item">
                <span>מחיר השכרה משוער:</span>
                <span id="estimatedRentalPrice">טוען...</span>
            </div>
        </div>
        <div class="comps-button-container">
            <button id="getCompsButton" class="comps-button">בצע</button>
        </div>
    </div>
    <div class="footer-links-container">
        <div class="footer-link-box">
            <a href="https://gengine.co/home" target="_blank">גרמסונית</a>
        </div>
        <div class="footer-link-box">
            <a href="https://gremson.com/" target="_blank">כרטיס ביקור GREMSON LLC</a>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Get references to all input elements
            const dollarRateInput = document.getElementById('dollarRateInput');
            const b1Input = document.getElementById('b1Input');
            const d2Input = document.getElementById('d2Input');
            const equityInvestmentInput = document.getElementById('equityInvestmentInput');
            const loanAmountActualInput = document.getElementById('loanAmountActualInput');
            const loanInterestRateInput = document.getElementById('loanInterestRateInput');
            const b3Input = document.getElementById('b3Input'); // B3 input
            const d3Input = document.getElementById('d3Input'); // D3 input
            const resetButton = document.getElementById('resetButton'); // Reset button
            // Changed to specific span IDs for clocks
            const easternTimeDisplay = document.getElementById('easternTimeDisplay'); // Eastern US Clock display span
            const israelTimeDisplay = document.getElementById('israelTimeDisplay'); // Israel Clock display span

            // Get references to display elements
            const a1ValueSpan = document.getElementById('a1Value');
            const a2ValueSpan = document.getElementById('a2Value');
            const c1ValueSpan = document.getElementById('c1Value');
            const d1ValueSpan = document.getElementById('d1Value');
            const b2ValueSpan = document.getElementById('b2Value');
            const c2ValueSpan = document.getElementById('c2Value');
            const a3ValueSpan = document.getElementById('a3Value'); // A3 display span
            const c3ValueSpan = document.getElementById('c3Value'); // C3 display span
            const loanInvestmentDisplay = document.getElementById('loanInvestmentDisplay');
            const refinanceDollarValue = document.getElementById('refinanceDollarValue'); // New refinance dollar display (H4)
            const refinancePercentageInput = document.getElementById('refinancePercentageInput'); // New refinance percentage input (H3)
            const h3ValueLoanDisplaySpan = document.getElementById('h3ValueLoanDisplay'); // H5 display span in loan table

            // New ILS display spans
            const c1ValueILS = document.getElementById('c1ValueILS');
            const c2ValueILS = document.getElementById('c2ValueILS');
            const c3ValueILS = document.getElementById('c3ValueILS');
            const loanInvestmentDisplayILS = document.getElementById('loanInvestmentDisplayILS');
            const refinanceDollarValueILS = document.getElementById('refinanceDollarValueILS');

            // Comps elements
            const addressInput = document.getElementById('addressInput');
            const estimatedSalePrice = document.getElementById('estimatedSalePrice');
            const estimatedRentalPrice = document.getElementById('estimatedRentalPrice');
            const getCompsButton = document.getElementById('getCompsButton'); // Get comps button


            const inputElements = [
                dollarRateInput, b1Input, d2Input,
                equityInvestmentInput, loanAmountActualInput, loanInterestRateInput,
                b3Input, d3Input, refinancePercentageInput // Add new input to the list for saving/loading
            ];

            /**
             * Updates the Eastern US time clock.
             */
            function updateEasternTime() {
                const now = new Date();
                // Options for Eastern US time (New York) without seconds
                const options = {
                    timeZone: 'America/New_York',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false // Use 24-hour format
                };
                const easternTime = now.toLocaleTimeString('en-US', options);
                easternTimeDisplay.textContent = easternTime;
            }

            /**
             * Updates the Israeli time clock.
             */
            function updateIsraeliTime() {
                const now = new Date();
                // Options for Israeli time (Jerusalem) without seconds
                const options = {
                    timeZone: 'Asia/Jerusalem',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false // Use 24-hour format
                };
                const israelTime = now.toLocaleTimeString('he-IL', options);
                israelTimeDisplay.textContent = israelTime;
            }

            // Update the clocks every second
            setInterval(updateEasternTime, 1000);
            setInterval(updateIsraeliTime, 1000);

            // Initial clock updates
            updateEasternTime();
            updateIsraeliTime();

            /**
             * Formats a number with thousands separators for Hebrew locale.
             * @param {number} value - The number to format.
             * @param {number} [decimalPlaces=0] - The number of decimal places to show. Defaults to 0.
             * @returns {string} The formatted string.
             */
            function formatNumber(value, decimalPlaces = 0) {
                return value.toLocaleString('he-IL', {
                    minimumFractionDigits: decimalPlaces, // Set minimum based on parameter
                    maximumFractionDigits: decimalPlaces  // Set maximum based on parameter
                });
            }

            /**
             * Saves the value of an input field to localStorage.
             * @param {HTMLInputElement} inputElement - The input element to save.
             */
            function saveInputValue(inputElement) {
                localStorage.setItem(inputElement.id, inputElement.value);
            }

            /**
             * Loads the value for an input field from localStorage.
             * If a value exists, it sets the input's value.
             * Also ensures the loaded value is not negative for specific inputs.
             * @param {HTMLInputElement} inputElement - The input element to load value for.
             * @param {string} defaultValue - The default value to use if nothing is in localStorage.
             */
            function loadInputValue(inputElement, defaultValue) {
                const savedValue = localStorage.getItem(inputElement.id);
                if (savedValue !== null) {
                    inputElement.value = savedValue;
                } else {
                    inputElement.value = defaultValue;
                }
                // Ensure non-negative for loan inputs and percentages
                if (inputElement === loanAmountActualInput || inputElement === loanInterestRateInput || inputElement === d3Input || inputElement === refinancePercentageInput) {
                    if (parseFloat(inputElement.value) < 0) {
                        inputElement.value = '0';
                    }
                }
            }

            /**
             * Validates and updates the value of an input field, ensuring it's non-negative.
             * @param {HTMLInputElement} inputElement - The input element to validate.
             */
            function validateNonNegative(inputElement) {
                if (parseFloat(inputElement.value) < 0) {
                    inputElement.value = '0';
                }
            }

            /**
             * Calculates the loan amount plus simple interest and updates the display in F2.
             */
            function updateF2() {
                // Ensure values are non-negative before calculation
                validateNonNegative(loanAmountActualInput);
                validateNonNegative(loanInterestRateInput);

                const principal = parseFloat(loanAmountActualInput.value) || 0;
                const interestRate = parseFloat(loanInterestRateInput.value) || 0;
                const dollarRate = parseFloat(dollarRateInput.value) || 1;


                // Calculate simple interest: Principal + (Principal * Interest Rate / 100)
                const totalAmountWithInterest = principal * (1 + (interestRate / 100));
                console.log(`F2 Calculation Debug: Principal=${principal}, Rate=${interestRate}, Result=${totalAmountWithInterest}`); // Debug log
                loanInvestmentDisplay.textContent = formatNumber(totalAmountWithInterest);
                loanInvestmentDisplayILS.textContent = formatNumber(totalAmountWithInterest * dollarRate); // Update ILS
                updateA1A2(); // Call updateA1A2 whenever F2 changes
            }

            /**
             * Calculates the sum of F1 and F2 and updates A1, A2.
             * Formula: A1 = F1 + F2
             * Formula: A2 = F1 + F2
             */
            function updateA1A2() {
                const f1Value = parseFloat(equityInvestmentInput.value) || 0;
                // Get the numeric value from F2's display span, removing commas
                const f2Value = parseFloat(loanInvestmentDisplay.textContent.replace(/,/g, '')) || 0;

                const totalInvestment = f1Value + f2Value;
                console.log(`A1/A2 Calculation Debug: F1=${f1Value}, F2=${f2Value}, Result=${totalInvestment}`); // Debug log
                a1ValueSpan.textContent = formatNumber(totalInvestment);
                a2ValueSpan.textContent = formatNumber(totalInvestment);

                updateC1D1(); // Call updateC1D1 whenever A1 changes
                updateA2B2C2(); // Call updateA2B2C2 whenever A2 changes
                updateH5(); // F1 changes, so update H5
            }

            /**
             * Calculates C1 and D1 based on A1 and B1 using the specified formulas.
             * C1 = B1 * 0.9 - A1
             * D1 = C1 / A1
             */
            function updateC1D1() {
                const a1Value = parseFloat(a1ValueSpan.textContent.replace(/,/g, '')) || 0;
                const b1Value = parseFloat(b1Input.value) || 0;
                const dollarRate = parseFloat(dollarRateInput.value) || 1;

                // C1 = B1 * 0.9 - A1
                const c1Calculation = (b1Value * 0.9) - a1Value;
                c1ValueSpan.textContent = formatNumber(c1Calculation);
                c1ValueILS.textContent = formatNumber(c1Calculation * dollarRate); // Update ILS
                console.log(`C1 Calculation Debug: B1=${b1Value}, A1=${a1Value}, Result=${c1Calculation}`); // Debug log

                let d1Calculation = 0;
                if (a1Value !== 0) {
                    d1Calculation = (c1Calculation / a1Value) * 100; // Convert to percentage
                }
                d1ValueSpan.textContent = formatNumber(d1Calculation) + '%';
                console.log(`D1 Calculation Debug: C1=${c1Calculation}, A1=${a1Value}, Result=${d1Calculation}%`); // Debug log
                updateH5(); // C1 changes, so update H5
            }

            /**
             * Calculates B2 and C2 based on A2 and D2 using the specified formulas.
             * C2 = A2 * D2
             * B2 = (A2 + C2) / 0.9
             */
            function updateA2B2C2() {
                const a2Value = parseFloat(a2ValueSpan.textContent.replace(/,/g, '')) || 0;
                const d2Value = parseFloat(d2Input.value) || 0;
                const dollarRate = parseFloat(dollarRateInput.value) || 1;

                // C2 = A2 * D2 (assuming D2 is a percentage, so divide by 100)
                const c2Calculation = a2Value * (d2Value / 100);
                c2ValueSpan.textContent = formatNumber(c2Calculation);
                c2ValueILS.textContent = formatNumber(c2Calculation * dollarRate); // Update ILS
                console.log(`C2 Calculation Debug: A2=${a2Value}, D2=${d2Value}, Result=${c2Calculation}`); // Debug log

                // B2 = (A2 + C2) / 0.9
                let b2Calculation = 0;
                if (0.9 !== 0) { // Avoid division by zero
                    b2Calculation = (a2Value + c2Calculation) / 0.9;
                }
                b2ValueSpan.textContent = formatNumber(b2Calculation);
                console.log(`B2 Calculation Debug: A2=${a2Value}, C2=${c2Calculation}, Result=${b2Calculation}`); // Debug log
            }

            /**
             * Calculates A3 and C3 based on B3 and D3 using the latest specified formulas.
             * A3 = B3 * 0.9 / (1 + D3)
             * C3 = A3 * D3
             */
            function updateA3C3() {
                const b3Value = parseFloat(b3Input.value) || 0; // Get B3 value
                const d3Value = parseFloat(d3Input.value) || 0; // Get D3 value (percentage)
                const dollarRate = parseFloat(dollarRateInput.value) || 1;

                let a3Calculation = 0;
                // A3 = B3 * 0.9 / (1 + D3) -- assuming D3 is percentage, so D3/100
                if ((1 + (d3Value / 100)) !== 0) { // Avoid division by zero
                    a3Calculation = (b3Value * 0.9) / (1 + (d3Value / 100));
                }
                a3ValueSpan.textContent = formatNumber(a3Calculation);
                console.log(`A3 Calculation Debug: B3=${b3Value}, D3=${d3Value}, Result=${a3Calculation}`); // Debug log

                // C3 = A3 * D3 (assuming D3 is percentage, so D3/100)
                const c3Calculation = a3Calculation * (d3Value / 100);
                c3ValueSpan.textContent = formatNumber(c3Calculation);
                c3ValueILS.textContent = formatNumber(c3Calculation * dollarRate); // Update ILS
                console.log(`C3 Calculation Debug: A3=${a3Calculation}, D3=${d3Value}, Result=${c3Calculation}`); // Debug log
            }

            /**
             * Calculates H3 (refinance percentage) and the corresponding dollar value (H4).
             * Updates the display in the investment table.
             */
            function updateH3() {
                validateNonNegative(refinancePercentageInput);
                const h3Value = parseFloat(refinancePercentageInput.value) || 0;
                const b1Value = parseFloat(b1Input.value) || 0;
                const dollarRate = parseFloat(dollarRateInput.value) || 1;

                // Calculate the dollar value for the refinance row in the investment table (H4)
                const refinanceDollarCalculation = b1Value * (h3Value / 100);
                refinanceDollarValue.textContent = formatNumber(refinanceDollarCalculation);
                refinanceDollarValueILS.textContent = formatNumber(refinanceDollarCalculation * dollarRate); // Update ILS

                console.log(`H3 (input) Debug: ${h3Value}%`);
                console.log(`Refinance Dollar (H4) Debug: B1=${b1Value}, H3=${h3Value}, Result=${refinanceDollarCalculation}`);
            }

            /**
             * Calculates H5 based on C1 and F1.
             * Updates the display in the loan details table.
             */
            function updateH5() {
                const c1Value = parseFloat(c1ValueSpan.textContent.replace(/,/g, '')) || 0;
                const f1Value = parseFloat(equityInvestmentInput.value) || 0;

                let h5Calculation = 0;
                if (f1Value !== 0) {
                    h5Calculation = (c1Value / f1Value) * 100; // Convert to percentage
                }
                h3ValueLoanDisplaySpan.textContent = formatNumber(h5Calculation, 2);
                console.log(`H5 calculated (C1/F1) Debug: ${h5Calculation}%`);
            }

            /**
             * Fetches comps data from LLM based on address.
             * @param {string} address The address to get comps for.
             */
            async function getCompsData(address) {
                if (!address) {
                    estimatedSalePrice.textContent = 'הזן כתובת';
                    estimatedRentalPrice.textContent = 'הזן כתובת';
                    return;
                }

                estimatedSalePrice.textContent = 'טוען...';
                estimatedRentalPrice.textContent = 'טוען...';

                // Updated prompt as per user's request
                const prompt = `תן לי comps לנכסים בעלי מאפיינים דומים (מספר חדרים, אמבטיות, מגרש, שנת בניה וכ' ככל שתמצא לנכון) שנמכרו או הושכרו בחצי שנה האחרונה ברדיוס של חצי מייל מהנכס אך לא חוצים זיפ רוד. את התשובות אתה מחזיר לטבלה בפרויקט בהתאמה: מכירה למכירה - השכרה להשכרה. כתובת הנכס: "${address}"`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "salePrice": { "type": "STRING" },
                                "rentalPrice": { "type": "STRING" }
                            },
                            "propertyOrdering": ["salePrice", "rentalPrice"]
                        }
                    }
                };

                const apiKey = ""; // Leave as-is for Canvas to provide
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const jsonString = result.candidates[0].content.parts[0].text;
                        const parsedJson = JSON.parse(jsonString);

                        estimatedSalePrice.textContent = parsedJson.salePrice || 'N/A';
                        estimatedRentalPrice.textContent = parsedJson.rentalPrice || 'N/A';
                    } else {
                        estimatedSalePrice.textContent = 'שגיאה בטעינה';
                        estimatedRentalPrice.textContent = 'שגיאה בטעינה';
                        console.error('Unexpected LLM response structure:', result);
                    }
                } catch (error) {
                    estimatedSalePrice.textContent = 'שגיאה: ' + error.message;
                    estimatedRentalPrice.textContent = 'שגיאה: ' + error.message;
                    console.error('Error fetching comps data:', error);
                }
            }


            /**
             * Sets default values for specified input fields and triggers recalculations.
             */
            function resetToDefaults() {
                b1Input.value = '350000';
                b3Input.value = '350000';
                d2Input.value = '20';
                d3Input.value = '20';
                dollarRateInput.value = '3.65';
                equityInvestmentInput.value = '300000';
                loanAmountActualInput.value = '0';
                loanInterestRateInput.value = '0';
                refinancePercentageInput.value = '75'; // Set default for new input (H3)
                addressInput.value = ''; // Clear address input on reset

                // Save the new default values to localStorage
                inputElements.forEach(saveInputValue);

                // Trigger all necessary updates after setting defaults
                updateF2();
                updateA3C3();
                updateH3(); // Call H3 update after reset
                updateC1D1(); // Ensure C1/D1 are updated if B1 changed
                updateA2B2C2(); // Ensure A2/B2/C2 are updated if D2 changed
                updateH5(); // Call H5 update after reset
                estimatedSalePrice.textContent = 'טוען...'; // Reset comps display
                estimatedRentalPrice.textContent = 'טוען...'; // Reset comps display
            }

            // Load saved values or set defaults on page load
            loadInputValue(dollarRateInput, '3.75'); // E1 can have decimals
            loadInputValue(b1Input, '120000');
            loadInputValue(d2Input, '30');
            loadInputValue(equityInvestmentInput, '100000'); // Set a non-zero default for F1
            loadInputValue(loanAmountActualInput, '10000');
            loadInputValue(loanInterestRateInput, '10');
            loadInputValue(b3Input, '0'); // Default B3 can be 0 or synced with B1 initially
            loadInputValue(d3Input, '0'); // Default D3 can be 0
            loadInputValue(refinancePercentageInput, '75'); // Load for new input (H3)
            loadInputValue(addressInput, ''); // Load address input

            // Add event listeners to save input values and trigger calculations
            inputElements.forEach(input => {
                input.addEventListener('input', () => {
                    saveInputValue(input);
                    // Handle B1/B3 synchronization
                    if (input === b1Input) {
                        b3Input.value = input.value; // Sync B3 with B1
                        saveInputValue(b3Input); // Save synced B3
                        updateC1D1(); // B1 changes affect C1/D1
                        updateA3C3(); // B1 change (via B3 sync) affects A3/C3
                        updateH3(); // B1 also affects the refinance dollar value (H4)
                    } else if (input === b3Input) {
                        b1Input.value = input.value; // Sync B1 with B3
                        saveInputValue(b1Input); // Save synced B1
                        updateA3C3(); // B3 changes affect A3/C3
                        updateC1D1(); // B3 change (via B1 sync) affects C1/D1
                        updateH3(); // B1 (via B3 sync) also affects the refinance dollar value (H4)
                    }
                    // Trigger relevant update functions based on which input changed (excluding B1/B3 as they are handled above)
                    else if (input === equityInvestmentInput || input === loanAmountActualInput || input === loanInterestRateInput) {
                        updateF2(); // F1, H1, H2 changes affect F2, which then updates A1/A2 and cascades
                        updateA3C3(); // A2 (affected by A1/A2 cascade) changes -> update A3/C3
                        // H3 is now an input, so no need to call updateH3 here directly based on F1/H1/H2
                    } else if (input === d2Input) {
                        updateA2B2C2(); // D2 changes affect A2/B2/C2
                        updateA3C3(); // A2 (affected by A2B2C2) changes -> update A3/C3
                    } else if (input === b3Input || input === d3Input) { // B3 and D3 now control A3/C3
                        updateA3C3();
                    } else if (input === refinancePercentageInput) { // New input for H3
                        updateH3();
                    } else if (input === dollarRateInput) { // New: dollar rate input
                        updateC1D1();
                        updateA2B2C2();
                        updateA3C3();
                        updateF2();
                        updateH3(); // For H4
                        updateH5(); // For H5
                    }
                });
            });

            // Add event listener for comps button
            getCompsButton.addEventListener('click', () => {
                const address = addressInput.value;
                if (address) {
                    const promptText = `תן לי comps לנכסים בעלי מאפיינים דומים (מספר חדרים, אמבטיות, מגרש, שנת בניה וכ' ככל שתמצא לנכון) שנמכרו או הושכרו בחצי שנה האחרונה ברדיוס של חצי מייל מהנכס אך לא חוצים זיפ רוד. כתובת הנכס: "${address}"`;
                    // Open Gemini in a new tab with the prompt pre-filled
                    window.open(`https://gemini.google.com/app?q=${encodeURIComponent(promptText)}`, '_blank');
                    // Trigger the LLM call to get data for the project's display fields
                    getCompsData(address);
                } else {
                    alert("אנא הזן כתובת כדי לקבל נתוני Comps.");
                }
            });

            // Add event listener for the reset button
            resetButton.addEventListener('click', resetToDefaults);

            // Perform initial calculations when the page loads after loading saved values
            updateF2(); // This will trigger the cascade of updates: F2 -> A1/A2 -> C1/D1 & A2/B2/C2
            updateA3C3(); // Initial call for A3 and C3
            updateH3(); // Initial call for H3 (refinance)
            updateH5(); // Initial call for H5 (C1/F1)
            // No initial call for getCompsData on load if addressInput is empty
        });
    </script>
</body>
</html>
